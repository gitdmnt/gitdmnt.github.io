---
import Common from "../../layouts/Common.astro";
import Card from "../../components/Card.astro";
import { Temporal } from "temporal-polyfill";

export async function getStaticPaths({ paginate }) {
  const posts: Record<string, any>[] = Object.values(
    import.meta.glob("/src/content/article/*.{md,mdx}", { eager: true })
  );
  posts.sort(
    (a, b) =>
      Date.parse(b.frontmatter.pubDate) - Date.parse(a.frontmatter.pubDate)
  );

  return paginate(posts, { pageSize: 10 });
}
const { page } = Astro.props as {
  page: {
    data: Array<{
      frontmatter: { title: string; description?: string; pubDate?: string };
      file: string;
    }>;
    url: { prev?: string | null; next?: string | null };
    currentPage: number;
  };
};
---

<Common
  url={Astro.url.href}
  type="blog"
  title="屋根裏"
  description="紙が散らばっている"
  image=""
>
  <main>
    <ul class="article-list">
      {
        page.data.map((p) => (
          <Card
            title={p.frontmatter.title}
            href={"/blog/" + p.file.split("/").pop().split(".")[0]}
            body={p.frontmatter.description}
            date={Temporal.PlainDate.from(
              (p.frontmatter.pubDate ?? "1970-01-01").slice(0, 10)
            ).toString()}
          />
        ))
      }
    </ul>
    <ul class="page-list">
      {
        () => {
          if (page.url.prev != null) {
            return (
              <li class="page prev">
                <a href={page.url.prev}>{page.currentPage - 1}</a>
              </li>
            );
          } else {
            return;
          }
        }
      }
      <li class="page curr">{page.currentPage}</li>
      {
        () => {
          if (page.url.next != null) {
            return (
              <li class="page next">
                <a href={page.url.next}>{page.currentPage + 1}</a>
              </li>
            );
          } else {
            return;
          }
        }
      }
    </ul>
  </main>
</Common>
<style>
  ul {
    list-style: none;
    margin: auto;
    padding: 0;
  }
  .article-list {
    display: flex;
    flex-direction: row;
    justify-content: flex-start;
    flex-wrap: wrap;
  }
  .page-list {
    margin-inline: auto;
    margin-block: 2rem;
    display: flex;
    flex-direction: row;
    gap: 0.5rem;
    justify-content: center;
  }
  .page {
    margin: 0;
    box-sizing: content-box;
    padding: 0.5rem;
    border: 1px solid #1d1d1d;
    color: #1d1d1d;
  }
  .prev {
    text-align: center;
  }
  .curr {
    background: #1d1d1d;
    text-align: center;
    color: #fffefd;
  }
  .next {
    text-align: center;
  }
  a {
    color: #1d1d1d;
    text-decoration: none;
    width: 100%;
    display: block;
    height: 100%;
  }
</style>
